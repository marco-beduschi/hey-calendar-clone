<dialog id="new_calendar_event_dialog">
</dialog>

<div class="week-grid">
  <div>
    <div class="week-grid__header">
      <span class="week-grid__date"></span>
      <% Date.current.all_week.each do |day| %>
        <span class="week-grid__date">
          <small>
            <%= day.strftime("%a") %>
          </small>
          <strong>
            <%= day.strftime("%d") %>
          </strong>
        </span>
      <% end %>
    </div>
    <div class="week-grid__body">
      <div class="week-grid__day">
        <% (24.hours/0.5.hour).to_i.times do |half_hours| %>
          <div class="week-grid__slot week-grid__clock-slot">
            <span class="week-grid__clock text-xs">
              <%= ( Time.current.beginning_of_day + (30.minutes * half_hours) ).strftime("%I %p") if ( half_hours % 2 == 0 && half_hours != 0 ) %>
            </span>
            <div class="week-grid__clock-gutter"></div>
          </div>
        <% end %>
      </div>
      <% Date.current.all_week.each do |day| %>
        <div class="week-grid__day">
          <% @calendar_events.select { _1.starts_at.to_date == day }.each do |event| %>
            <%= render partial: "calendar_events/calendar_event", locals: { calendar_event: event } %>
          <% end %>
          <% (24.hours/0.5.hour).to_i.times do |half_hours| %>
            <div class="week-grid__time-slot" style="--grid-row-start: <%= half_hours + 1 %>; --grid-row-end: <%= (half_hours + 1) + 1 %>;">
              <%= link_to(
                new_calendar_event_path(
                  calendar_event: {
                    starts_at: day.to_time(:utc).beginning_of_day + (30.minutes * half_hours),
                    ends_at: (day.to_time(:utc).beginning_of_day + (30.minutes * half_hours) + 29.minutes),
                    calendar_id: calendar.id
                  }
                ),
                data: {
                  turbo_stream: true,
                  controller: "dialog",
                  action: "dialog#open",
                  dialog_dialog_id_value: "new_calendar_event_dialog"
                }
              ) do %>
                  <span class="sr-only">Create event</span>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
